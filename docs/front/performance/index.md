---
hidden: true
---
# 性能优化

## 性能指标

1. 页面加载速度：指页面从开始加载到完全加载完成所需的时间。页面加载速度越快，用户体验就越好。
2. 资源加载时间：指页面中各个资源文件（如HTML、CSS、JavaScript、图片等）的加载时间。资源加载时间越短，页面响应速度就越快。
3. 渲染速度：指页面元素在浏览器中渲染的速度。渲染速度越快，用户看到的页面内容就越快。
4. 页面大小：指页面文件的大小，包括HTML、CSS、JavaScript、图片等资源文件的大小。页面大小越小，下载和加载速度就越快。
5. 代码质量：指前端代码的质量，包括可读性、可维护性、可扩展性等。代码质量越高，开发效率和代码稳定性就越好。
6. 响应时间：指页面对于用户交互的响应速度。响应时间越快，用户体验就越好。
7. 移动端适配：指前端页面在不同设备（如手机、平板等）上的适配效果。移动端适配越好，用户体验就越好。
8. 安全性：指前端页面的安全性，包括跨站脚本攻击（XSS）、跨站请求伪造（CSRF）等安全问题的防范。安全性越高，用户体验和网站安全性就越好。


## 页面性能指标 - 性能指标定义

官方地址：(https://developer.mozilla.org/en-US/docs/Web/API/Performance)

> performance很多方法 属性都废弃了，performance.toJSON() 返回的属性才是目前支持的

> 三大性能指标：  LCP：最大内容绘制、FID：首次输入延迟、CLS：累计位移偏移

LCP 代表了页面的速度指标，虽然还存在其他的一些体现速度的指标，但是上文也说过 LCP 能体现的东西更多一些。一是指标实时更新，数据更精确，二是代表着页面最大元素的渲染时间，通常来说页面中最大元素的快速载入能让用户感觉性能还挺好。

FID 代表了页面的交互体验指标，毕竟没有一个用户希望触发交互以后页面的反馈很迟缓，交互响应的快会让用户觉得网页挺流畅。
     
CLS 代表了页面的稳定指标，尤其在手机上这个指标更为重要。因为手机屏幕挺小，CLS 值一大的话会让用户觉得页面体验做的很差。


* 性能核心指标主要包括：
  _**白屏时间 、 首屏时间、 页面完全加载时间**_，以及新增的用户体验指标 _**LCP、 FID、 CLS**_ 。

* 辅助性性能指标包括：
  DNS 解析 、请求响应时间、 DOM开始构建时间、 页面可交互时间、 DOM构建完成时间、 网络速度、 各类静态资源耗时、 ajax请求耗时、 LongTask 等等。

### 含义说明

* 页面加载时间：指从页面开始加载到页面完全加载完成所需的时间。
* 白屏时间：指浏览器发起请求到开始显示第一个页面元素的时间。
* 首屏时间：指用户可以看到页面上主要内容所需要的时间。
* 整页时间：指从开始加载到所有元素都被加载完成后，在一定时间内（通常为2秒）仍然没有网络活动的时间。
* DOMContentLoaded时间：指DOM结构完全解析完成的时间。
* Load时间：指页面完成所有资源加载和渲染的时间。


#### LCP：最大内容绘制     牛逼 < 2.5s < 一般  < 4s < 辣鸡

> Largest Contentful Paint (LCP)：视口内可见的最大图片或文本块的呈现时间。

- 哪些元素会影响 LCP 的值？  
  文本相关的元素或节点、图片相关的元素，包括<img>元素、通过url()加载的背景图片等。

- 关于元素的大小：  
LCP 仅考虑用户看得到的部分。例如，一个元素有部分内容是在视口之外，这些部分不会计入元素的大小。对于图片元素，如果是缩小其原始大小，则以显示时的大小为准；如果是拉伸其尺寸，则以其原始大小为准。
对于所有元素，不考虑通过 CSS 添加的任何外边距、内边距或边框。

```js
// f12 console输入获取 LCP 值
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    console.log('LCP candidate:', entry.startTime, entry);
  }
}).observe({type: 'largest-contentful-paint', buffered: true});

```

#### FID：首次输入延迟   牛逼 < 100ms < 一般  < 300ms < 辣鸡

> First Input Delay（FID）: 用户首次与网页互动 （如点击） 到浏览器实际开始处理脚本，以响应该互动的时间。

FID 通常发生在 FCP 和 TTI 之间。Time to Interactive (TTI): 从网页开始加载 到主要子资源已加载 且能够快速可靠地响应用户输入的时间。 我们都知道，JavaScript 引擎是单线程的。如上图所示，在 JavaScript 文件下载完成后，会在主线程开始处理，这会导致主线程处理忙碌状态。假设用户在耗时最长的任务途中忽然开始于网页交互，那么他必须等到该任务处理完成后，浏览器才能响应该次交互。这个时间差是用户必须等待的时间，即 FID。

> 除了事件监听函数，有些 HTML 元素也需要等到主线程任务完成后才能响应用户互动，包括\<input>、\<textarea>、\<select>和\<a>。

> FID 仅仅测量的是 延迟时间，不包括这个事件处理本身需要的时间和事件处理后浏览器更新界面的时间。

```js
// f12 console输入获取 FID 值
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntries()) {
    const delay = entry.processingStart - entry.startTime;
    console.log('FID candidate:', delay, entry);
  }
}).observe({type: 'first-input', buffered: true});

```

#### CLS：累积布局偏移  牛逼 < 0.1 < 一般  < 0.25 < 辣鸡

> Cumulative Layout Shift(CLS)：用于衡量页面的可见内容偏移的程度。


* 什么情况下视为发生了布局偏移？

当现有元素更改其起始位置时，才会发生布局偏移， 添加新元素或者现有元素更改尺寸不计入布局偏移中。布局偏移的计算与Layout Instability API 有关，

布局偏移分数 = 影响分数 * 距离分数。影响比例 为变动大小占总视口的百分比，即两个帧变动块的并集。距离分数 为不稳定元素相对于视口的 移动距离 占总视口的百分比。


> 布局偏移肯定是无法避免的，例如用户的交互触发了一些布局和网页内容的变动，但是我们可以通过预先占好空间、显示进度加载组件、添加过渡动画等，帮助用户更好地了解接下来发生了什么。


#### DCL: DOMContentLoaded





---

## 有哪些工具可以监测和分析前端性能优化指标？

1. Lighthouse：是一个开源的自动化工具，用于帮助改进网络应用的质量。它可以评估页面性能、可访问性、无障碍性、SEO等方面，并提供改进建议。
2. SpeedCurve：可以帮助追踪自己的性能表现，以及竞争对手的性能表现。它提供了一个完整的性能管理平台，包括网页速度分析、性能日志、性能预算等功能。
3. Pingdom：在Pingdom输入URL地址，即可测试页面加载速度，分析并找出性能瓶颈。它还提供了实时监控、报告和警报等功能。
4. PageSpeed Insights：提供免费服务，可以分析网页的内容，提出建议，加快网页的速度。它为您提供了关键指标，如第一个内容绘制，总阻塞时间和更多。
5. WebPageTest：是一个在线的免费性能评测网站，支持IE，Chrome，使用真正的浏览器(IE和Chrome)和真实的消费者连接速度，从全球多个地点运行免费网站速度测试。可以运行简单的测试或执行高级测试，包括多步骤事务、视频捕获、内容阻塞等等。
6. Chrome DevTools：是Chrome浏览器自带的一个开发者工具，可以在浏览器中实时监测和优化网页性能。
7. New Relic：是一个完整的应用性能管理(APM)解决方案，可以监测和分析网页性能和应用程序性能。
8. WebPageTest API：是一个可以编程访问WebPageTest的API，可以在自己的网站或应用程序中使用WebPageTest的功能。


## 方向

性能优化是一个纬度比较大的方向

可以从http、项目本身以及加钱解法（增加服务起配置）几个方面


### http

- dns预解析
- http2.0
- http缓存



### 项目

- 降低http请求数

浏览器允许同时并发请求数目是有限制的（一般4-7个？），因此，后边的资源需要等待前面的资源加载后才能开始加载（阻塞）。


- 精灵图 
- webpack、vite等打包工具合并资源（小图base64）
- 路由懒加载
- 组件懒加载
- 图片懒加载
- cdn分发
- 开启gzip
- 服务端渲染

### 加钱解法

无脑增加服务器配置（带宽...）








